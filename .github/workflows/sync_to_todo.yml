name: Advanced Sync to ToDo Project

on:
  issues:
    types: [opened, labeled, unlabeled, edited]

jobs:
  sync_fields:
    runs-on: ubuntu-latest
    steps:
      - name: Add to Project
        env:
          GH_TOKEN: ${{ secrets.CONNECT_TODO }}
        run: |
          # 変数設定
          ISSUE_URL="${{ github.event.issue.html_url }}"
          PROJECT_NUM="9"
          
          # プロジェクトにアイテムを追加
          echo "Adding issue to project..."
          item_id=$(gh project item-add "$PROJECT_NUM" \
            --owner "@me" \
            --url "$ISSUE_URL" \
            --format json | jq -r '.id')
          
          if [ -z "$item_id" ] || [ "$item_id" == "null" ]; then
            echo "::error::Failed to add item to project"
            exit 1
          fi
          
          echo "✓ Successfully added with item ID: $item_id"
